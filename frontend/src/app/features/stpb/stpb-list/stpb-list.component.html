<div class="stpb-list-container">
  <app-page-header title="Surat Tanda Pertanggungjawaban Belanja (STPB)" subtitle="Kelola data STPB">
    <button nz-button nzType="primary" class="add-button" (click)="createNew()">
      <span nz-icon nzType="plus"></span>
      Tambah STPB Baru
    </button>
  </app-page-header>

  <div class="content-wrapper">
    <div class="search-container">
      <nz-input-group [nzPrefix]="prefixIconSearch" class="search-input">
        <input 
          type="text" 
          nz-input 
          placeholder="Cari nomor STPB atau deskripsi..." 
          [(ngModel)]="searchTerm" 
          (keyup.enter)="onSearch()" 
        />
      </nz-input-group>
      <ng-template #prefixIconSearch>
        <span nz-icon nzType="search"></span>
      </ng-template>
      <button nz-button nzType="text" class="refresh-button" (click)="loadStpbs()">
        <span nz-icon nzType="reload"></span>
      </button>
    </div>

    <nz-table 
      #basicTable 
      [nzData]="stpbs" 
      [nzLoading]="loading"
      [nzFrontPagination]="false"
      [nzTotal]="total"
      [nzPageSize]="pageSize"
      [nzPageIndex]="pageIndex"
      (nzPageIndexChange)="onPageChange($event)"
      [nzShowSizeChanger]="true"
      [nzPageSizeOptions]="[10, 20, 50]"
      (nzPageSizeChange)="onPageSizeChange($event)"
      class="modern-table">
      <thead>
        <tr>
          <th>Nomor STPB</th>
          <th>Tanggal</th>
          <th>Uraian</th>
          <th nzAlign="right">Nilai Bersih</th>
          <th>Status</th>
          <th>Tanggal Dibuat</th>
          <th nzWidth="120px" nzAlign="center">Aksi</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let data of basicTable.data">
          <td>
            <span class="stpb-number">{{ data.nomorSTPB }}</span>
          </td>
          <td>{{ data.tanggal | date: 'dd/MM/yyyy' }}</td>
          <td>
            <span class="description-text">{{ data.uraian || '-' }}</span>
          </td>
          <td nzAlign="right">
            <span class="amount-text">{{ data.nilaiBersih | number: '1.0-0' }}</span>
          </td>
          <td>
            <nz-tag [nzColor]="data.isLocked ? 'red' : 'green'" class="status-tag">
              {{ data.isLocked ? 'Terkunci' : 'Aktif' }}
            </nz-tag>
          </td>
          <td>{{ data.createdAt | date: 'dd/MM/yyyy HH:mm' }}</td>
          <td nzAlign="center">
            <div class="action-buttons">
              <button nz-button nzType="text" nzSize="small" nz-tooltip="Print PDF" (click)="printPdf(data.id)" class="action-btn print-btn">
                <span nz-icon nzType="file"></span>
              </button>
              <button nz-button nzType="text" nzSize="small" nz-tooltip="Edit" (click)="edit(data.id)" class="action-btn edit-btn" [disabled]="data.isLocked">
                <span nz-icon nzType="edit"></span>
              </button>
              <button nz-button nzType="text" nzSize="small" nz-tooltip="Hapus" (click)="delete(data.id, data.nomorSTPB)" class="action-btn delete-btn" [disabled]="data.isLocked">
                <span nz-icon nzType="delete"></span>
              </button>
            </div>
          </td>
        </tr>
      </tbody>
    </nz-table>
  </div>

  <nz-modal
    [(nzVisible)]="pdfModalVisible"
    nzTitle="Preview STPB PDF"
    [nzWidth]="1000"
    [nzFooter]="null"
    (nzOnCancel)="closePdfModal()">
    <ng-container *nzModalContent>
      <div style="width: 100%; height: 70vh;">
        <iframe *ngIf="pdfUrl" [src]="pdfUrl" style="width: 100%; height: 100%; border: none;"></iframe>
      </div>
    </ng-container>
  </nz-modal>
</div>
